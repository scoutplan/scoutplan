<% presenter = EventPresenter.new(@event, current_member) %>

<%= turbo_frame_tag "rsvp_popup" do %>
  <div class="z-40 fixed inset-0 bg-black/10 backdrop-blur">
    <div class="z-40 px-6 py-4 rounded-lg w-[calc(100%-2rem)] md:w-auto md:max-w-lg bg-white absolute drop-shadow-overhead left-1/2 bottom-4 md:bottom-auto md:top-1/2 -translate-x-1/2 md:-translate-y-1/2">
      <%= button_tag nil,
            class: "text-stone-500 hover:text-stone-950 text-xl absolute top-0 right-0 p-4",
            data: { action: "click->popup#close" } do %>
        <i class="fa-light fa-times"></i>
      <% end %>

      <%= render partial: "family_rsvps/header", locals: { unit_membership: current_member, event: @event } %>

      <%= form_with url: unit_event_family_rsvps_path(@event.unit, @event), method: :post, format: :turbo_stream,
                    data: { controller: "rsvp-submit", action: "submit->rsvp-submit#submit" } do |f| %>
        <section class="py-4 rounded-lg">
          <%= render partial: "events/edit_rsvp_fields", locals: { event: @event, unit: current_unit, presenter: presenter, f: f } %>
        </section>

        <footer class="mt-4">
          <%= f.button type: "submit",
                      id: "rsvp_submit",
                      class: "block px-6 py-2 w-full rounded bg-brand-500 hover:bg-brand-600 text-white font-medium cursor-pointer",
                      data: { rsvp_submit_target: "button" } do %>
            <%= @family_rsvp.new_record? ? "Send RSVP" : "Update RSVP" %>
          <% end %>
        </footer>
      <% end %>

      <div class="hidden absolute inset-0 rounded-lg bg-white flex flex-col items-center justify-center" data-rsvp-submit-target="overlay">
        <i class="fa-regular fa-compass text-brand-500 text-5xl animate-compass-swing"></i>
        <p class="mt-4 text-stone-500 font-medium">Sending your RSVP&hellip;</p>
      </div>
    </div>
  </div>
<% end %>
